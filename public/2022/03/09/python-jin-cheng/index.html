<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="python进程, python,Linux,C/C++,LaTeX,Markdown等">
    <meta name="description" content="python进程相关模块的使用">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>python进程 | HMZ-blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">HMZ-blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/navigate" class="waves-effect waves-light">
      
      <i class="fas fa-location-arrow" style="zoom: 0.6;"></i>
      
      <span>导航</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">HMZ-blog</div>
        <div class="logo-desc">
            
            本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/navigate" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-location-arrow"></i>
			
			导航
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hhhhmdzz/hhhhmdzz.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hhhhmdzz/hhhhmdzz.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">python进程</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/python/">
                                <span class="chip bg-color">python</span>
                            </a>
                        
                            <a href="/tags/%E8%BF%9B%E7%A8%8B/">
                                <span class="chip bg-color">进程</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/python/" class="post-category">
                                python
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-03-09
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-08-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    11.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    48 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="python进程"><a href="#python进程" class="headerlink" title="python进程"></a>python进程</h1><p><font color="orange">For Windows</font></p>
<p>[toc]</p>
<h2 id="进程的概念"><a href="#进程的概念" class="headerlink" title="进程的概念"></a>进程的概念</h2><ul>
<li>outline<ul>
<li><a href="#def">进程的定义</a></li>
<li><a href="#char">进程的特征</a></li>
<li><a href="#disp">进程调度</a></li>
<li><a href="#parl">进程的并行与并发</a></li>
<li><a href="#state">进程的状态</a></li>
<li><a href="#lib">python中的进程库</a></li>
</ul>
</li>
</ul>
<p>————————————————————</p>
<ul>
<li><a id="def"><font color="lightblue">进程的定义</font></a><ul>
<li>狭义定义<br>进程是正在运行的程序的实例(an instance of a computer program that is being executed)。</li>
<li>广义定义<br>进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。</li>
</ul>
</li>
</ul>
<p>简单来说，进程就是程序的基本执行实体。</p>
<p>————————————————————</p>
<ul>
<li><a id="char"><font color="lightblue">进程的特征</font></a><ul>
<li>动态性：进程的实质是程序在多道程序系统中的一次执行过程，进是动态产生，动态消亡的。</li>
<li>并发性：任何进程都可以同其他进程一起并发执行</li>
<li>独立性：进程是一个能独立运行的基本单位，同时也是系统分配资和调度的独立单位；</li>
<li>异步性：由于进程间的相互制约，使进程具有执行的间断性，即进按各自独立的、不可预知的速度向前推进</li>
<li>结构特征：进程由程序、数据和进程控制块三部分组成。</li>
<li>多个不同的进程可以包含相同的程序：一个程序在不同的数据集里就构成不同的进程，能得到不同的结果；但是执行过程中，程序不能发生改变。</li>
</ul>
</li>
</ul>
<p>————————————————————</p>
<ul>
<li><a id="disp"><font color="lightblue">进程调度</font></a><ul>
<li>先来先服务调度算法：利于长作业（进程），而不利于短作业（进程）</li>
<li>短作业优先调度算法：对短作业或短进程优先调度</li>
<li>时间片轮转法：让每个进程在就绪队列中的等待时间与享受服务的时间成比例</li>
<li>多级反馈队列：目前被公认的一种较好的进程调度算法</li>
</ul>
</li>
</ul>
<p>————————————————————</p>
<ul>
<li><a id="parl"><font color="lightblue">进程的并行与并发</font></a><ul>
<li>并行：多个进程同时执行</li>
<li>并发：多个进程交替进行</li>
</ul>
</li>
</ul>
<p>————————————————————</p>
<ul>
<li><p><a id="state"><font color="lightblue">进程的状态</font></a>：创建、就绪、运行、阻塞、退出</p>
</li>
<li><p>同步与异步</p>
<ul>
<li>同步：可靠的任务序列，进程1依赖于进程2，只有进程2完成后，进程1才算完成，即这两个进程状态保持一致。</li>
<li>异步：不可靠的任务序列，进程1依赖于进程2，不管进程2是否完成，进程1自己完成就算完成，即这两个进程状态不一定保持一致。</li>
</ul>
</li>
<li><p>阻塞与非阻塞：即程序等待消息的状态。</p>
</li>
<li><p>同步/异步与阻塞/非阻塞</p>
<ul>
<li>同步阻塞：效率最低(只排队)</li>
<li>异步阻塞：效率较低(只叫号)</li>
<li>同步非阻塞：效率较低(排队+打电话)</li>
<li>异步非阻塞：效率高(叫号+打电话)</li>
</ul>
</li>
</ul>
<p>————————————————————</p>
<ul>
<li><p><a id="lib"><font color="lightblue">python中的进程库</font></a></p>
<ul>
<li><code>subprocess</code>：适用于与外部进程交互，调用外部进程</li>
</ul>
<p><code>subprocess</code>用来执行外部命令，是<code>os.fork()</code>和<code>os.execve()</code>的封装，即先fork一个子进程，再运行新的外部程序，<font color="orange">子进程不会把父进程的模块加载一遍</font>。</p>
<ul>
<li><code>multiprocessing</code></li>
</ul>
<p><code>multiprocessing</code>的原理是fork，<code>fork()</code>调用：调用1次，返回两次——操作系统自动把当前进程（父进程）复制了一份（子进程），然后，分别在父进程和子进程内返回，父进程返回子进程的pid，子进程返回0，即父进程和子进程都在运行。对于外部调用来说，使用multiprocessing太占资源。</p>
</li>
</ul>
<hr>
<h2 id="进程的基本操作"><a href="#进程的基本操作" class="headerlink" title="进程的基本操作"></a>进程的基本操作</h2><h3 id="multiprocessing-Process-类"><a href="#multiprocessing-Process-类" class="headerlink" title="multiprocessing.Process 类"></a><code>multiprocessing.Process</code> 类</h3><ul>
<li>outline<ul>
<li><strong><a href="#Process intro">Process类介绍</a></strong></li>
<li><strong><a href="#Process examp">Process类实例</a></strong><ul>
<li><strong><a href="#Process0">使用Process开启一个子进程</a></strong></li>
<li><strong><a href="#Process1">继承Process开启一个子进程</a></strong></li>
<li><strong><a href="#Process2">使用Process守护进程</a></strong></li>
<li><strong><a href="#Process3">多进程socket聊天并发</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="Process intro"><font color="black"></font></a></p><h4><a id="Process intro"><font color="black">Process类介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Process</span><span class="token punctuation">{</span>
    group<span class="token punctuation">,</span>   <span class="token comment"># 参数未使用，值始终为None</span>
    target<span class="token punctuation">,</span>  <span class="token comment"># 调用对象，即子进程要执行的任务</span>
    args<span class="token punctuation">,</span>    <span class="token comment"># 调用对象的位置参数元组</span>
    kwargs<span class="token punctuation">,</span>  <span class="token comment"># 调用对象的字典</span>
    name<span class="token punctuation">,</span>    <span class="token comment"># 子进程的名称</span>
<span class="token punctuation">}</span></code></pre>

<details>
<summary>Process类方法、属性(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 方法</span>
p <span class="token operator">=</span> Process<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 创建子进程</span>
p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 启动子进程，并调用该子进程中的 p.run() </span>
p<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment"># 进程启动时运行的方法</span>
p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 强制终止进程</span>
p<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># 如果p仍然运行，返回True</span>
p<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>  <span class="token comment"># 主线程等待p终止，timeout是可选的超时时间</span>

<span class="token comment"># todo 属性</span>
p<span class="token punctuation">.</span>daemon    <span class="token comment"># 默认值为False</span>
p<span class="token punctuation">.</span>name      <span class="token comment"># 进程的名称</span>
p<span class="token punctuation">.</span>pid       <span class="token comment"># 进程的pid</span>
p<span class="token punctuation">.</span>exitcode  <span class="token comment"># 进程在运行时为None、如果为–N，表示被信号N结束(了解即可)</span>
p<span class="token punctuation">.</span>authkey   <span class="token comment"># 进程的身份验证键，默认是由os.urandom()随机生成的32字符的字符串</span></code></pre>

</details>

<details>
<summary>Process类方法、属性(详)</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 参数</span>
<span class="token keyword">class</span> <span class="token class-name">Process</span><span class="token punctuation">{</span>
    group<span class="token punctuation">,</span>   <span class="token comment"># 参数未使用，值始终为None</span>
    target<span class="token punctuation">,</span>  <span class="token comment"># 调用对象，即子进程要执行的任务</span>
    args<span class="token punctuation">,</span>    <span class="token comment"># 调用对象的位置参数元组</span>
    kwargs<span class="token punctuation">,</span>  <span class="token comment"># 调用对象的字典</span>
    name<span class="token punctuation">,</span>    <span class="token comment"># 子进程的名称</span>
<span class="token punctuation">}</span>

<span class="token comment"># todo 方法</span>
p <span class="token operator">=</span> Process<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 创建子进程</span>
p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 启动子进程，并调用该子进程中的 p.run() </span>
p<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment"># 进程启动时运行的方法</span>
    <span class="token triple-quoted-string string">"""
    调用target指定的函数，自定义类的类中一定要实现该方法
    """</span>
p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 强制终止进程</span>
    <span class="token triple-quoted-string string">"""
    如果p创建了子进程，该子进程就成了僵尸进程，使用该方法需要特别小心这种情况
    如果p还保存了一个锁那么也将不会被释放，进而导致死锁
    """</span>
p<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># 如果p仍然运行，返回True</span>
p<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>  <span class="token comment"># 主线程等待p终止，timeout是可选的超时时间</span>
    <span class="token triple-quoted-string string">"""
    p.join只能join住start开启的进程，而不能join住run开启的进程
    """</span>

<span class="token comment"># todo 属性</span>
p<span class="token punctuation">.</span>daemon  <span class="token comment"># 默认值为False</span>
    <span class="token triple-quoted-string string">"""
    如果设为True，代表p为后台运行的守护进程，当p的父进程终止时，p也随之终止
    并且设定为True后（必须在p.start()之前设置），p不能创建自己的新进程
    """</span>
p<span class="token punctuation">.</span>name  <span class="token comment"># 进程的名称</span>
p<span class="token punctuation">.</span>pid  <span class="token comment"># 进程的pid</span>
p<span class="token punctuation">.</span>exitcode  <span class="token comment"># 进程在运行时为None、如果为–N，表示被信号N结束(了解即可)</span>
p<span class="token punctuation">.</span>authkey  <span class="token comment"># 进程的身份验证键，默认是由os.urandom()随机生成的32字符的字符串</span>
    <span class="token triple-quoted-string string">"""
    这个键的用途是为涉及网络连接的底层进程间通信提供安全性，这类连接只有在具有相同的身份验证键时才能成功（了解即可）
    """</span>

<span class="token comment"># todo 注意事项</span>
<span class="token triple-quoted-string string">"""
在Windows创建子进程的时候会自动 import 启动它的这个文件，
而在 import 的时候又执行了整个文件。
因此如果将process()直接写在文件中就会无限递归创建子进程报错，
所以必须把创建子进程的部分使用
if __name__ ==‘__main__’:
    pass
判断保护起来，import 的时候，就不会递归运行了。
而且不能在交互式的编辑器下面使用，比如：Jupyter 等！
"""</span></code></pre>

</details>

<blockquote>
<p>注：<br>1.子进程的执行顺序不是根据启动顺序决定的<br>2.<code>p.terminate()</code>强制关闭进程，但是不会立即关闭，可以通过<code>p.is_alive()</code>查看是否存活<br>3.可以通过<code>p.join()</code>让主进程等到子进程真正结束<br>4.关闭子进程应先 <code>p.terminate()</code> 再 <code>p.join()</code></p>
</blockquote>
<p><a id="Process examp"><font color="black"></font></a></p><h4><a id="Process examp"><font color="black">Process类实例</font></a></h4><p></p>
<ul>
<li><a id="Process0">使用Process开启一个子进程</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process

<span class="token keyword">def</span> <span class="token function">sub_process</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"正在运行子进程......"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"子进程PID：</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">，父进程PID：</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>getppid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"子进程的参数：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"正在运行主进程......"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"主进程PID：</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"准备运行子进程......"</span></span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>
        target<span class="token operator">=</span>sub_process<span class="token punctuation">,</span>
        args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"开始运行子进程......"</span></span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"主进程等待子进程结束......"</span></span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"子进程运行结束......"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"主进程运行即将结束......"</span></span><span class="token punctuation">)</span></code></pre>

<ul>
<li><a id="Process1">继承Process开启一个子进程</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process

<span class="token keyword">class</span> <span class="token class-name">MyProcess</span><span class="token punctuation">(</span>Process<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""自定义类 继承Process类"""</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>arg1 <span class="token operator">=</span> arg1
        self<span class="token punctuation">.</span>arg2 <span class="token operator">=</span> arg2

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""必须实现一个run方法，run方法中是在子进程中执行的代码"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"process name:</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">, PID:</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>pid<span class="token punctuation">}</span></span><span class="token string">,args:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>arg1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>arg2<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> MyProcess<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<ul>
<li><a id="Process2">使用Process守护进程</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process

<span class="token keyword">def</span> <span class="token function">daemon_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> i_func
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        i_func <span class="token operator">+=</span> <span class="token number">1</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'守护进程还活着</span><span class="token interpolation"><span class="token punctuation">{</span>i_func<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">com_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'普通进程开始......'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'普通进程结束......'</span><span class="token punctuation">)</span>

i_func <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    p_d <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>daemon_process<span class="token punctuation">)</span>
    p_d<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 设置子进程为守护进程</span>
    p_d<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p_c <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>com_process<span class="token punctuation">)</span>  <span class="token comment"># 普通进程</span>
    p_c<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"普通进程：</span><span class="token interpolation"><span class="token punctuation">{</span>p_c<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">，是否活着：</span><span class="token interpolation"><span class="token punctuation">{</span>p_c<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    p_c<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"普通进程：</span><span class="token interpolation"><span class="token punctuation">{</span>p_c<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">，是否活着：</span><span class="token interpolation"><span class="token punctuation">{</span>p_c<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"准备休眠......"</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"休眠结束......"</span><span class="token punctuation">)</span></code></pre>

<ul>
<li><a id="Process3">多进程socket聊天并发</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token comment"># server</span>


<span class="token comment"># client</span>


</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用多进程实现socket聊天并发-server</span>
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process

server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>
server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">talk</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>client_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            msg<span class="token operator">=</span>conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> msg<span class="token punctuation">:</span><span class="token keyword">break</span>
            conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">break</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span> <span class="token comment">#windows下start进程一定要写到这下面</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        conn<span class="token punctuation">,</span>client_addr<span class="token operator">=</span>server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>talk<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>client_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#client端</span>
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;: '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> msg<span class="token punctuation">:</span><span class="token keyword">continue</span>
 
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    msg <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<hr>
<h2 id="子进程"><a href="#子进程" class="headerlink" title="子进程"></a>子进程</h2><p><font color="red" size="6">焯！太TM难写了，不写了，自己看博客吧.<br>这么多博客，总有一款适合你。</font><font size="10"><span class="github-emoji"><span>😅</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></font></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/python3-subprocess.html">subprocess-菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/subprocess.html">subprocess-官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/songhaixing/p/14275042.html">subprocess-相关博客-博客园1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-qing-/p/10934322.html">subprocess-相关博客-博客园2</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/133941.htm">subprocess-相关博客-脚本之家</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39059031/article/details/108440342">subprocess-相关博客-CSDN</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/430c411160f8">subprocess-相关博客-简书</a></p>
<h3 id="subprocess-模块"><a href="#subprocess-模块" class="headerlink" title="subprocess 模块"></a><code>subprocess</code> 模块</h3><p><code>subprocess</code>模块，用来创建和管理子进程，并能够与创建的子进程的<code>stdin</code>、<code>stdout</code>、<code>stderr</code>连接通信，获取子进程执行结束后的<font color="orange">返回码</font>，在执行超时或执行错误时得到<font color="orange">异常</font>。</p>
<p>问题：<br>multiprocessing中，调用p.join()等待子进程执行结束<br>subprocess模块–父进程如何监听子进程结束？<br>两个方法：<br>subprocess.Popen()父进程开启子进程后，不管其是否结束，直接执行下一步；<br>subprocess.Call()父进程一直等待到子进程运行结束，再执行下一步；</p>
<ul>
<li>outline<ul>
<li><strong><a href="#subprocess intro"><code>subprocess</code> 模块介绍</a></strong></li>
<li><strong><a href="#subprocess examp"><code>subprocess</code> 模块实例</a></strong><ul>
<li><strong><a href="#subprocess.run"><code>subprocess.run</code> 例子</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="subprocess intro"><font color="black"></font></a></p><h4><a id="subprocess intro"><font color="black"><code>subprocess</code> 模块介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 执行args参数所表示的命令，等待命令执行完毕，返回一个CompletedProcess对象。</span>
subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 父进程开启子进程后，不管其是否结束，直接执行下一步；</span>
subprocess<span class="token punctuation">.</span>Call<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 不推荐使用，父进程一直等待到子进程运行结束，再执行下一步；</span></code></pre>

<blockquote>
<p><code>run</code>函数的底层就是<code>Popen</code>函数。<code>run</code>同步，<code>Popen</code>异步。<br><strong>同步函数</strong>：当一个函数是同步执行时，那么当该函数被调用时<font color="orange">不会立即返回</font>，直到该函数所要做的事情全都做完了才返回。<br><strong>异步函数</strong>：如果一个异步函数被调用时，该函数<font color="orange">会立即返回</font>尽管该函数规定的操作任务还没有完成。</p>
<blockquote>
<p><code>call</code>、<code>check_call</code>、<code>check_output</code>、<code>getoutput</code>、<code>getstatusoutput</code>、这些函数，都被<code>run</code>函数代替了，它们在存在只是为了保持向下兼容。</p>
</blockquote>
</blockquote>
<ul>
<li><code>subprocess</code>的方法、类</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>
    args<span class="token punctuation">,</span>                     <span class="token comment"># 通过创建进程而执行的命令及参数</span>
    stdin<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># 指定命令的输入途径</span>
    <span class="token builtin">input</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># 命令的具体输入内容</span>
        <span class="token triple-quoted-string string">"""
        input与stdin不能同时使用
        input默认是一个bytes流
        """</span>
    stdout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># 指定命令的输出途径</span>
    stderr<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># 指定命令的error输出途径</span>
    capture_output<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>     <span class="token comment"># 是否捕获进程的输出</span>
        <span class="token triple-quoted-string string">"""
        capture_output=True的效果与设置以下的效果一样。
            stdout=PIPE, stderr=PIPE
        设置了capture_output=True，就不能再设置stdout和stderr
        """</span>
    shell<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              <span class="token comment"># 是否通过shell来执行命令（Linux下默认为/bin/sh）</span>
        <span class="token triple-quoted-string string">"""
        shell=False：args只能是一个不带参数的命令字符串，或者是命令和参数组成的一个list
        shell=True：args就可以是一个我们常见的命令字符串
        """</span>
    cwd<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 <span class="token comment"># 指示了当前工作路径</span>
    timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             <span class="token comment"># 设置进程执行的超时时间</span>
        <span class="token triple-quoted-string string">"""
        如果时间到子进程还未结束，subprocess.TimeoutExpired异常会抛出。
        timeout参数的单位：秒
        """</span>
    check<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              <span class="token comment"># 检查异常？</span>
        <span class="token triple-quoted-string string">"""
        如果check=True，
        在子进程的返回不为 0 的时候，抛出subprocess.CalledProcessError异常。
        这时，run函数返回的CompletedProcess对象的returncode不可用。
        """</span>
    encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            <span class="token comment"># </span>
    errors<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># </span>
    text<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                <span class="token comment"># 将stdin，stdout，stderr修改为string模式</span>
        <span class="token triple-quoted-string string">"""
        stdin，stdout，stderr本来都是字节流bytes
        """</span>
    env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 <span class="token comment"># </span>
    universal_newlines<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># 同text</span>
        <span class="token triple-quoted-string string">"""
        这个参数的存在也是为了向下兼容
        从Python3.7开始有text参数
        而Python3.5和3.6都是universal_newlines参数
        因此使用text参数就好了
        """</span>
<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">subprocess</span><span class="token punctuation">.</span>PopenPopen<span class="token punctuation">(</span>
    args<span class="token punctuation">,</span>                     <span class="token comment"># 通过创建进程而执行的命令及参数</span>
    bufsize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment"># </span>
    executable<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>          <span class="token comment"># </span>
    stdin<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># 指定命令的输入途径</span>
    stdout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># 指定命令的输出途径</span>
    stderr<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># 指定命令的error输出途径</span>
    preexec_fn<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>          <span class="token comment"># </span>
    close_fds<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>           <span class="token comment"># </span>
    shell<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>              <span class="token comment"># 是否通过shell来执行命令</span>
    cwd<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 <span class="token comment"># 指示了当前工作路径</span>
    env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                 <span class="token comment"># </span>
    universal_newlines<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># 同text</span>
    startupinfo<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         <span class="token comment"># </span>
    creationflags<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>          <span class="token comment"># </span>
    restore_signals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>     <span class="token comment"># </span>
    start_new_session<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># </span>
    pass_fds<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment"># </span>
    encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>            <span class="token comment"># </span>
    errors<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>              <span class="token comment"># </span>
    text<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                <span class="token comment"># 将stdin，stdout，stderr修改为string模式</span>
<span class="token punctuation">)</span></code></pre>

<ul>
<li><code>subprocess.Popen</code>的方法</li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python">proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>args<span class="token punctuation">)</span>                 <span class="token comment"># </span>
out<span class="token punctuation">,</span> err <span class="token operator">=</span> proc<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span>bstr<span class="token punctuation">)</span>  <span class="token comment"># </span>
returncode <span class="token operator">=</span> proc<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>    <span class="token comment"># </span></code></pre>

<details>
<summary>nothing</summary>

</details>

<p><a id="subprocess examp"><font color="black"></font></a></p><h4><a id="subprocess examp"><font color="black"><code>subprocess</code> 模块实例</font></a></h4><p></p>
<ul>
<li><a id="subprocess.run"><code>subprocess.run</code> 例子</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo run args:str、shell</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> proc <span class="token operator">=</span> run<span class="token punctuation">(</span><span class="token string">'dir'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
······
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> proc<span class="token punctuation">.</span>args
<span class="token string">'dir'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> proc<span class="token punctuation">.</span>returncode
<span class="token number">0</span>

<span class="token comment"># todo run args:list、shell</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p <span class="token operator">=</span> run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ipconfig"</span><span class="token punctuation">,</span> <span class="token string">"/all"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
······
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> proc<span class="token punctuation">.</span>args
<span class="token punctuation">[</span><span class="token string">"ipconfig"</span><span class="token punctuation">,</span> <span class="token string">"/all"</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> proc<span class="token punctuation">.</span>returncode
<span class="token number">0</span></code></pre>

<hr>
<h2 id="一些非常有用的函数"><a href="#一些非常有用的函数" class="headerlink" title="一些非常有用的函数"></a>一些非常有用的函数</h2><h3 id="multiprocessing-freeze-support-函数"><a href="#multiprocessing-freeze-support-函数" class="headerlink" title="multiprocessing.freeze_support() 函数"></a><code>multiprocessing.freeze_support()</code> 函数</h3><ul>
<li>outline<ul>
<li><strong><a href="#freeze_support intro"><code>freeze_support()</code> 函数介绍</a></strong></li>
<li><strong><a href="#freeze_support examp"><code>freeze_support()</code> 函数实例</a></strong></li>
</ul>
</li>
</ul>
<p><a id="freeze_support intro"><font color="black"></font></a></p><h4><a id="freeze_support intro"><font color="black"><code>freeze_support()</code> 函数介绍</font></a></h4><p></p>
<ul>
<li>为什么要有<code>freeze_support()</code>？</li>
</ul>
<p>官方解释：<a target="_blank" rel="noopener" href="https://docs.python.org/3.8/library/multiprocessing.html?highlight=freeze_support#multiprocessing.freeze_support">multiprocessing.freeze_support()¶</a><br>　　当使用<code>multiprocessing</code>的程序被冻结以生成Windows可执行文件时，添加对该程序的支持。（已使用<code>Py2Exe</code>、<code>PyInstaller</code>和<code>cx_Freeze</code>进行了测试。）<br>个人理解：参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Owen_goodman/article/details/115521388">multiprocessing.freeze_support()介绍</a><br>　　Python多进程<code>multiprocessing</code>在 Windows 的 Dos 或者 idle 下运行不了会报错，打包成.exe双击之后会一直打开exe，导致内存占满（至于为什么会造成内存溢出，暂时不得而知，后面还需要再研究一下），在 PyCharm 下运行也不会有问题，在 Linux 下没有问题。为了解决这个 bug，python3.8 添加了这个函数。</p>
<p><font color="orange">简单来说就是，本来之前把使用<code>multiprocessing</code>的程序打包成.exe文件有 bug，但是现在只要在<code>main</code>入口下添加<code>multiprocessing.freeze_support()</code>就可以解决这个 bug 了。</font></p>
<ul>
<li>关于<code>freeze_support()</code>，再多说几句</li>
</ul>
<ol>
<li>如果没有调用 <code>freeze_support()</code> 在尝试运行被冻结的可执行文件时会抛出 <code>RuntimeError</code> 异常。</li>
<li>对 <code>freeze_support()</code> 的调用在非 Windows 平台上是无效的。如果该模块在 Windows 平台的 Python 解释器中正常运行 (该程序没有被冻结)， 调用<code>freeze_support()</code> 也是无效的。</li>
<li>如果程序将正常运行而不是冻结，则可以省略 <code>freeze_support()</code>。</li>
<li>总的来说，不管怎样最好加上 <code>freeze_support()</code>。</li>
</ol>
<p><code>freeze_support()</code>源代码：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">freeze_support</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    Run code for process object if this in not the main process
    '''</span>
    <span class="token keyword">if</span> is_forking<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span>
        kwds <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> arg <span class="token keyword">in</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            name<span class="token punctuation">,</span> value <span class="token operator">=</span> arg<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token string">'None'</span><span class="token punctuation">:</span>
                kwds<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                kwds<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        spawn_main<span class="token punctuation">(</span><span class="token operator">**</span>kwds<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><a id="freeze_support examp"><font color="black"></font></a></p><h4><a id="freeze_support examp"><font color="black"><code>freeze_support()</code> 函数实例</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> freeze_support

<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    freeze_support<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
<h2 id="进程同步"><a href="#进程同步" class="headerlink" title="进程同步"></a>进程同步</h2><h3 id="multiprocess-Lock-类"><a href="#multiprocess-Lock-类" class="headerlink" title="multiprocess.Lock 类"></a><code>multiprocess.Lock</code> 类</h3><h3 id="multiprocess-Semaphore-类"><a href="#multiprocess-Semaphore-类" class="headerlink" title="multiprocess.Semaphore 类"></a><code>multiprocess.Semaphore</code> 类</h3><h3 id="multiprocess-Event-类"><a href="#multiprocess-Event-类" class="headerlink" title="multiprocess.Event 类"></a><code>multiprocess.Event</code> 类</h3><hr>
<h2 id="进程间的通信模式"><a href="#进程间的通信模式" class="headerlink" title="进程间的通信模式"></a>进程间的通信模式</h2><p>进程间的通信模式 IPC (Inter-Process Communication)</p>
<h3 id="multiprocessing-Pipe-方法"><a href="#multiprocessing-Pipe-方法" class="headerlink" title="multiprocessing.Pipe 方法"></a><code>multiprocessing.Pipe</code> 方法</h3><ul>
<li>outline<ul>
<li><strong><a href="#Pipe intro">Pipe方法介绍</a></strong></li>
<li><strong><a href="#Pipe examp">Pipe方法实例</a></strong><ul>
<li><strong><a href="#Pipe0">Pipe两个进程间通信</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="Pipe intro"><font color="black"></font></a></p><h4><a id="Pipe intro"><font color="black">Pipe方法介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">Pipe</span><span class="token punctuation">(</span>duplex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment"># 通信模式</span>
    <span class="token keyword">return</span> conn1<span class="token punctuation">,</span> conn2  <span class="token comment"># 返回一个管道的两端</span></code></pre>

<blockquote>
<p><code>duplex=True</code>：全双工模式（默认），双方均可收发<br><code>duplex=False</code>：conn1只接收，conn2只发送</p>
</blockquote>
<details>
<summary>Pipe方法(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python">pipe <span class="token operator">=</span> Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># </span>
pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>recv<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>                       <span class="token comment"># 接收</span>
pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>                       <span class="token comment"># 发送</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># </span>
conn<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># </span>
conn<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># </span>
conn<span class="token punctuation">.</span>recv_bytes<span class="token punctuation">(</span><span class="token punctuation">[</span>maxlength<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token comment"># </span>
conn<span class="token punctuation">.</span>send_bytes<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> size<span class="token punctuation">)</span>   <span class="token comment"># </span>
conn<span class="token punctuation">.</span>recv_bytes_into<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span>    <span class="token comment"># </span></code></pre>

</details>

<details>
<summary>Pipe方法(详)</summary>

<pre class="language-python" data-language="python"><code class="language-python">pipe <span class="token operator">=</span> Pipe<span class="token punctuation">(</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>recv<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>  <span class="token comment"># 接收</span>
pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>  <span class="token comment"># 发送</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    关闭连接，如果conn被垃圾回收，将自动调用此方法
    """</span>
conn<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    返回连接使用的整数文件描述符
    """</span>
conn<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    如果连接上的数据可用，返回True。
    timeout指定等待的最长时限。
    如果省略此参数，方法将立即返回结果。
    如果将timeout射成None，操作将无限期地等待数据到达。
    """</span>
conn<span class="token punctuation">.</span>recv_bytes<span class="token punctuation">(</span><span class="token punctuation">[</span>maxlength<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    接收 conn.send_bytes() 方法发送的一条完整的字节消息。
    maxlength指定要接收的最大字节数。
    如果进入的消息，超过了这个最大值，将引发IOError异常，并且在连接上无法进行进一步读取。
    如果连接的另外一端已经关闭，再也不存在任何数据，将引发EOFError异常。
    """</span>
conn<span class="token punctuation">.</span>send_bytes<span class="token punctuation">(</span><span class="token builtin">buffer</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> offset <span class="token punctuation">[</span><span class="token punctuation">,</span> size<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    通过连接发送字节数据缓冲区，
    buffer是支持缓冲区接口的任意对象，
    offset是缓冲区中的字节偏移量，
    size是要发送字节数。
    结果数据以单条消息的形式发出，
    然后调用 conn.recv_bytes() 函数进行接收
    """</span>
conn<span class="token punctuation">.</span>recv_bytes_into<span class="token punctuation">(</span><span class="token builtin">buffer</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> offset<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    接收一条完整的字节消息，并把它保存在buffer对象中，
    该对象支持可写入的缓冲区接口（即bytearray对象或类似的对象）。
    offset指定缓冲区中放置消息处的字节位移。
    返回值是收到的字节数。
    如果消息长度大于可用的缓冲区空间，将引发BufferTooShort异常。
    """</span></code></pre>

</details>

<blockquote>
<p>注：<br>1.Pipe 的读写效率要高于 Queue<br>2.如果没有消息可接收，<code>conn.recv()</code>方法会一直阻塞。<br>3.如果管道已经被关闭，<code>conn.recv()</code>方法会抛出<code>EOFError</code>。<br>4.<code>conn.close()</code>并未关闭通道，只是把状态改为不可再插入元素的状态<br>5.Pipe是通过 socket 进行进程间通信的</p>
</blockquote>
<p><a id="Pipe examp"><font color="black"></font></a></p><h4><a id="Pipe examp"><font color="black">Pipe方法实例</font></a></h4><p></p>
<ul>
<li><a id="Pipe0">Pipe两个进程间通信</a></li>
</ul>
<p>pipe实现生产者和消费者一对一模型</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Pipe

<span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> product <span class="token keyword">in</span> products<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'生产者发送:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pipe<span class="token punctuation">.</span>send<span class="token punctuation">(</span>product<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> pipe<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'消费者接收:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'生产者跑路了'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>

products <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    pipe <span class="token operator">=</span> Pipe<span class="token punctuation">(</span>duplex<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    process_producer <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
    process_consumer <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>

    process_producer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    process_consumer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    process_producer<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    process_consumer<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>注：<br>1.若双方都没有使用管道的某个端点，就应该关闭管道<br>2.若一方关闭了端点，相应的另一端必须关闭其端点<br>3.应先关闭通道两端<code>pipe.close()</code>再关闭进程<code>proc.terminate()</code>再等待进程结束<code>proc.join()</code></p>
</blockquote>
<hr>
<h3 id="multiprocessing-Queue-类"><a href="#multiprocessing-Queue-类" class="headerlink" title="multiprocessing.Queue 类"></a><code>multiprocessing.Queue</code> 类</h3><ul>
<li>outline<ul>
<li><strong><a href="#Queue intro">Queue类介绍</a></strong></li>
<li><strong><a href="#Queue examp">Queue类实例</a></strong><ul>
<li><strong><a href="#Queue0">Queue多个进程间通信</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="Queue intro"><font color="black"></font></a></p><h4><a id="Queue intro"><font color="black">Queue类介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 参数</span>
<span class="token keyword">class</span> <span class="token class-name">Queue</span><span class="token punctuation">{</span>maxsize<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">}</span>  <span class="token comment"># 队列中允许的最大项数，忽略/默认无大小限制</span></code></pre>

<details>
<summary>Queue类方法(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 方法</span>
q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment"># 队列实例化</span>
q<span class="token punctuation">.</span>get<span class="token punctuation">(</span>block<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>        <span class="token comment"># 数据出队，阻塞</span>
q<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment"># 数据出队，非阻塞</span>
q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item<span class="token punctuation">,</span> block<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>  <span class="token comment"># 数据入队，阻塞</span>
q<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment"># 数据入队，非阻塞</span>
q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># 队列大小</span>
q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># 队列判空</span>
q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token comment"># 队列判满</span>
q<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># 关闭队列</span>
q<span class="token punctuation">.</span>cancel_join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 取消队列连接后台线程</span>
q<span class="token punctuation">.</span>join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment"># 队列连接后台线程</span></code></pre>

</details>

<details>
<summary>Queue类方法(详)</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 方法</span>
q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>get<span class="token punctuation">(</span> <span class="token punctuation">[</span> block <span class="token punctuation">[</span> <span class="token punctuation">,</span>timeout <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    返回q中的一个项目。
    如果q为空，此方法将阻塞，直到队列中有项目可用为止。
    block用于控制阻塞行为，默认为True。
    如果设置为False，将引发Queue.Empty异常（定义在Queue模块中）。
    timeout是可选超时时间，用在阻塞模式中。
    如果在制定的时间间隔内没有项目变为可用，将引发Queue.Empty异常。
    """</span>
q<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    同q.get(False)方法。
    """</span>
q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item <span class="token punctuation">[</span><span class="token punctuation">,</span> block <span class="token punctuation">[</span><span class="token punctuation">,</span>timeout <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    将item放入队列。
    如果队列已满，此方法将阻塞至有空间可用为止。
    block控制阻塞行为，默认为True。
    如果设置为False，将引发Queue.Empty异常（定义在Queue库模块中）。
    timeout指定在阻塞模式中等待可用空间的时间长短。
    超时后将引发Queue.Full异常。
    """</span>
q<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    同q.get(False)方法。
    """</span>
q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    返回队列中目前项目的正确数量。
    此函数的结果并不可靠，
    因为在返回结果和在稍后程序中使用结果之间，
    队列中可能添加或删除了项目。
    在某些系统上，此方法可能引发NotImplementedError异常。
    """</span>
q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    如果调用此方法时 q为空，返回True。
    如果其他进程或线程正在往队列中添加项目，结果是不可靠的。
    也就是说，在返回和使用结果之间，队列中可能已经加入新的项目。
    """</span>
q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    如果q已满，返回为True。
    由于线程的存在，结果也可能是不可靠的（参考q.empty（）方法）。
    """</span>
q<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    关闭队列，防止队列中加入更多数据。
    调用此方法时，后台线程将继续写入那些已入队列但尚未写入的数据，
    但将在此方法完成时马上关闭。
    如果q被垃圾收集，将自动调用此方法。
    关闭队列不会在队列使用者中生成任何类型的数据结束信号或异常。
    例如，如果某个使用者正被阻塞在get（）操作上，
    关闭生产者中的队列不会导致get（）方法返回错误。
    """</span>
q<span class="token punctuation">.</span>cancel_join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    不会再进程退出时自动连接后台线程。
    这可以防止join_thread()方法阻塞。
    """</span>
q<span class="token punctuation">.</span>join_thread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    连接队列的后台线程。
    此方法用于在调用q.close()方法后，
    等待所有队列项被消耗。
    默认情况下，此方法由不是q的原始创建者的所有进程调用。
    调用q.cancel_join_thread()方法可以禁止这种行为。
    """</span></code></pre>

</details>
<!-- <br/> -->

<blockquote>
<p>注：<br>1.底层队列使用管道和锁定实现<br>2.<code>q.put()</code>和<code>q.get()</code>是两个阻塞方法<br>3.<code>q.put_nowait()</code>和<code>q.get_nowait()</code>是两个非阻塞方法，故一定要做异常处理！！！<br>4.两个进程的 Queue 并不是同一个，而是将数据 pickle 后传给另一个进程的 Queue<br>5.Queue用于父进程与子进程之间的通信或同一父进程的子进程之间通信</p>
</blockquote>
<p><a id="Queue examp"><font color="black"></font></a></p><h4><a id="Queue examp"><font color="black">Queue类实例</font></a></h4><p></p>
<ul>
<li><a id="Queue0">Queue多个进程间通信</a></li>
</ul>
<p>Queue实现一方发送多方接收</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Queue

<span class="token keyword">def</span> <span class="token function">proc_put</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> data<span class="token punctuation">,</span> proc_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> dat <span class="token keyword">in</span> data<span class="token punctuation">:</span>  <span class="token comment"># 数据发送完就跳出</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span>dat<span class="token punctuation">)</span>  <span class="token comment"># 数据入队</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>proc_name<span class="token punctuation">}</span></span><span class="token string">方发送数据</span><span class="token interpolation"><span class="token punctuation">{</span>dat<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"队列满了！"</span></span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">proc_get</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> proc_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 数据接收完(没有数据)就跳出</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            dat <span class="token operator">=</span> q<span class="token punctuation">.</span>get_nowait<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 数据出队</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>proc_name<span class="token punctuation">}</span></span><span class="token string">方接收数据</span><span class="token interpolation"><span class="token punctuation">{</span>dat<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"队列空了！"</span></span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    proc_send1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>proc_put<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">"process send1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    proc_recv1 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>proc_get<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">"process recv1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    proc_recv2 <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>proc_get<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">"process recv2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    proc_send1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_recv1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_recv2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    proc_send1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_recv1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_recv2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
<h3 id="multiprocessing-JoinableQueue-类"><a href="#multiprocessing-JoinableQueue-类" class="headerlink" title="multiprocessing.JoinableQueue 类"></a><code>multiprocessing.JoinableQueue</code> 类</h3><p>可连接的共享进程队列</p>
<ul>
<li>outline<ul>
<li><strong><a href="#JQ intro">JoinableQueue类介绍</a></strong></li>
<li><strong><a href="#JQ examp">JoinableQueue类实例</a></strong></li>
</ul>
</li>
</ul>
<p><a id="JQ intro"><font color="black"></font></a></p><h4><a id="JQ intro"><font color="black">JoinableQueue类介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">JoinableQueue</span><span class="token punctuation">{</span>maxsize<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">}</span>  <span class="token comment"># 队列中允许的最大项数，忽略/默认无大小限制</span></code></pre>

<p><font color="grey">JoinableQueue的实例p除了与Queue对象相同的方法之外，还具有以下方法</font></p>
<details>
<summary>JoinableQueue类方法(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python">q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 发出信号表示q.get()返回的项目已经被处理</span>
q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 阻塞直到队列所有项目被处理为止，即所有项目被调用q.task_done()为止</span></code></pre>

<p><font>说白了，<code>q.task_done()</code>就是告诉 os 已经完成这一次的<code>q.get()</code>了，<code>q.join()</code>告诉 os：Queue已经取完、没有元素了，并且等待结束。</font></p>
</details>

<details>
<summary>JoinableQueue类方法(详)</summary>

<pre class="language-python" data-language="python"><code class="language-python">q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    使用者使用此方法发出信号，表示q.get()返回的项目已经被处理。
    如果调用此方法的次数大于从队列中删除的项目数量，将引发ValueError异常。
    """</span>
q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    生产者将使用此方法进行阻塞，直到队列中所有项目均被处理。
    阻塞将持续到为队列中的每个项目均调用q.task_done()方法为止。 
    """</span></code></pre>

</details>

<p><a id="JQ examp"><font color="black"></font></a></p><h4><a id="JQ examp"><font color="black">JoinableQueue类实例</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token punctuation">,</span> random
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> JoinableQueue

<span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        food <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s吃了一个%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> food<span class="token punctuation">)</span><span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 通知队列已经有一个数据被处理了</span>

<span class="token keyword">def</span> <span class="token function">producer</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> name<span class="token punctuation">,</span> food<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s生产了%s%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> food<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>food <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> JoinableQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_con <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>consumer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">'con'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    proc_prod <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>producer<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token string">'pro'</span><span class="token punctuation">,</span> <span class="token string">'馒头'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    proc_con<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 设置守护进程，否则永远运行，join()也没用</span>
    proc_con<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    proc_prod<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># proc_con.join()        # 不要使用join()，否则永远运行</span>
    proc_prod<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># 生产者要先把所有的数据都放到队列中</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token comment"># 阻塞直到放入队列中所有的数据都被处理掉(有多少个数据就接收到了多少task_done)</span></code></pre>

<hr>
<h2 id="进程间的数据共享"><a href="#进程间的数据共享" class="headerlink" title="进程间的数据共享"></a>进程间的数据共享</h2><h3 id="multiprocessing-Value-方法"><a href="#multiprocessing-Value-方法" class="headerlink" title="multiprocessing.Value 方法"></a><code>multiprocessing.Value</code> 方法</h3><h3 id="multiprocessing-Array-方法"><a href="#multiprocessing-Array-方法" class="headerlink" title="multiprocessing.Array 方法"></a><code>multiprocessing.Array</code> 方法</h3><p><code>Value</code>和<code>Array</code>差不多（<code>Value</code>和<code>Array</code>分别相当于数和数组），就放在一起了，它们都是将数据存储在<font color="red">共享内存</font>映射中。</p>
<p>在进行并发编程时，通常最好尽量避免使用共享状态。使用多个进程时尤其如此。但是，如果你真的需要使用一些共享数据，那么 <code>multiprocessing</code>提供了两种方法：<code>Value</code>和<code>Array</code>。</p>
<blockquote>
<p><code>Value</code>和<code>Array</code>是<font color="red">线程不安全</font>的，所以以下内容了解即可，因此建议使用线程安全的<code>Manager().Value</code>和<code>Manager().Array</code>。</p>
</blockquote>
<ul>
<li>outline<ul>
<li><strong><a href="#VA intro"><code>Value</code>和<code>Array</code>方法介绍</a></strong></li>
<li><strong><a href="#VA examp"><code>Value</code>和<code>Array</code>方法实例</a></strong></li>
</ul>
</li>
</ul>
<p><a id="VA intro"><font color="black"></font></a></p><h4><a id="VA intro"><font color="black"><code>Value</code>和<code>Array</code>方法介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">Value</span><span class="token punctuation">(</span>typecode_or_type<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> lock<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">Array</span><span class="token punctuation">(</span>typecode_or_type<span class="token punctuation">,</span> size_or_initializer<span class="token punctuation">,</span> lock<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    参数：
        typecode_or_type：返回 ctypes 对象的类型
        *args：传递给 ctypes 的构造参数
        size_or_initializer：数组的长度或者初始化数组的序列
        lock：是否加锁
    返回：
        以上方法返回从共享内存中分配的一个 ctypes 对象
    说明：
        1.size_or_initializer：如果它是一个整数，那么它确定数组的长度，并且数组将被初始化为零。
        否则，size_or_initializer是用于初始化数组的序列，其长度决定数组的长度。
        
        2. ctypes 是 Python 的一个外部函数库，它提供了和C语言兼任的数据类型，
        可以调用 DLLs 或者共享库的函数，能被用作在 python 中包裹这些库。
    例如：
        i = Value('i', 1)
        d = Value('d', 1)
        c = Value('c', '0')
    """</span></code></pre>

<p><code>'d'</code>和<code>'i'</code>参数是<code>array</code>模块使用的类型的<code>typecode</code>。<code>'d'</code>表示双精度浮点数，<code>'i'</code>表示有符号整数。<font color="red">这些共享对象将是进程和线程安全的。</font></p>
<p>为了更灵活地使用共享内存，可以使用<code>multiprocessing.sharedctypes</code>模块，该模块支持创建从共享内存分配的任意ctypes对象。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo Value属性</span>
v <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
v<span class="token punctuation">.</span>value</code></pre>

<ul>
<li><strong>共享整数或者单个字符</strong></li>
</ul>
<p>共享整数或者单个字符的初始化比较简单，可以直接在下面的<font color="red">code映射表</font>找到对应关系。</p>
<img src="/2022/03/09/python-jin-cheng/python进程-Value-Type_code.png" width="800">

<p><code>Value</code>初始化整数、字符例子：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Value

i <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></code></pre>

<ul>
<li><strong>共享字符串</strong></li>
</ul>
<p>如果共享的是字符串，则在上表是找不到映射关系的，就是没有code可用。所以我们需要使用原始的ctype类型：<font color="red">ctype类型对应表</font>。</p>
<img src="/2022/03/09/python-jin-cheng/python进程-Value-ctypes_type.png" width="830">

<p><code>Value</code>初始化字符串例子：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> ctypes <span class="token keyword">import</span> c_char_p
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Value<span class="token punctuation">,</span> Manager

<span class="token comment"># ss = Value(c_char_p, 'hello')  # 这里在我的环境会报错，使用下面的Manager则不会</span>
ss <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_char_p<span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ss<span class="token punctuation">)</span></code></pre>

<p><a id="VA intro"><font color="black"></font></a></p><h4><a id="VA intro"><font color="black"><code>Value</code>和<code>Array</code>方法实例</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Value<span class="token punctuation">,</span> Array

<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">3.1415927</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
    arr <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>f<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<hr>
<h3 id="multiprocessing-Manager-方法"><a href="#multiprocessing-Manager-方法" class="headerlink" title="multiprocessing.Manager 方法"></a><code>multiprocessing.Manager</code> 方法</h3><p><code>Manager</code>是通过共享进程的方式<font color="red">共享数据</font>。<font color="grey">简单来说就是，虽然进程间的数据不共享，但是一个进程可以通过<code>Manager</code>修改其他进程的数据。</font></p>
<p><code>Manager</code>管理的共享数据类型有：<code>Value</code>、<code>Array</code>、<code>dict</code>、<code>list</code>、<code>Lock</code>、<code>Semaphore</code>等等，同时<code>Manager</code>还可以共享类的实例对象。</p>
<p><code>Manager</code>不需要加锁，因为<code>Manager</code>已经默认给你加锁了。</p>
<ul>
<li>outline<ul>
<li><strong><a href="#Manager intro"><code>Manager</code>方法介绍</a></strong></li>
<li><strong><a href="#Manager examp"><code>Manager</code>方法实例</a></strong></li>
</ul>
</li>
</ul>
<p><a id="Manager intro"><font color="black"></font></a></p><h4><a id="Manager intro"><font color="black">Manager方法介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python">manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 实例化Manager对象</span>
manager<span class="token punctuation">.</span>Value<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># </span>
manager<span class="token punctuation">.</span>Array<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># </span>
manager<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># </span>
manager<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># </span>
manager<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># </span>
manager<span class="token punctuation">.</span>Semaphore<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># </span></code></pre>

<p><a id="Manager examp"><font color="black"></font></a></p><h4><a id="Manager examp"><font color="black">Manager方法实例</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Manager

<span class="token keyword">def</span> <span class="token function">func1</span><span class="token punctuation">(</span>shareList<span class="token punctuation">,</span> shareValue<span class="token punctuation">,</span> shareDict<span class="token punctuation">,</span> lock<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
        shareValue<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">1</span>
        shareDict<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'1'</span>
        shareDict<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'2'</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>shareList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            shareList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>
    list1   <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    value1  <span class="token operator">=</span> manager<span class="token punctuation">.</span>Value<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    dict1   <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    lock1   <span class="token operator">=</span> manager<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

    proc <span class="token operator">=</span> <span class="token punctuation">[</span>
        Process<span class="token punctuation">(</span>
            target<span class="token operator">=</span>func1<span class="token punctuation">,</span>
            args<span class="token operator">=</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> value1<span class="token punctuation">,</span> dict1<span class="token punctuation">,</span> lock1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>

    <span class="token keyword">for</span> p <span class="token keyword">in</span> proc<span class="token punctuation">:</span>
        p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> proc<span class="token punctuation">:</span>
        p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dict1<span class="token punctuation">)</span>

    array1 <span class="token operator">=</span> manager<span class="token punctuation">.</span>Array<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>array1<span class="token punctuation">)</span></code></pre>

<p>运行结果：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">21</span>, <span class="token number">22</span>, <span class="token number">23</span>, <span class="token number">24</span>, <span class="token number">25</span><span class="token punctuation">]</span>
Value<span class="token punctuation">(</span><span class="token string">'i'</span>, <span class="token number">21</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token number">1</span>: <span class="token string">'1'</span>, <span class="token number">2</span>: <span class="token string">'2'</span><span class="token punctuation">}</span>
array<span class="token punctuation">(</span><span class="token string">'i'</span>, <span class="token punctuation">[</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span>, <span class="token number">6</span>, <span class="token number">7</span>, <span class="token number">8</span>, <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<hr>
<h2 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h2><h3 id="multiprocessing-Pool-方法"><a href="#multiprocessing-Pool-方法" class="headerlink" title="multiprocessing.Pool 方法"></a><code>multiprocessing.Pool</code> 方法</h3><ul>
<li>outline<ul>
<li><strong><a href="#Pool intro">Pool方法介绍</a></strong></li>
<li><strong><a href="#Pool examp">Pool方法实例</a></strong><ul>
<li><strong><a href="#Pool0">使用多线程-应用apply</a></strong></li>
<li><strong><a href="#Pool1">使用多线程-映射map</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="Pool intro"><font color="black"></font></a></p><h4><a id="Pool intro"><font color="black">Pool方法介绍</font></a></h4><p></p>
<p>Pool可以提供指定数量的进程，供用户调用，当有新的请求提交到Pool中时，如果池还没有满，那么就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到规定最大值，那么该请求就会等待，直到池中有进程结束，才会创建新的进程来它。</p>
<details>
<summary>Pool方法(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python">p<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwds<span class="token punctuation">)</span>                  <span class="token comment"># 阻塞</span>
p<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwds<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>  <span class="token comment"># 非阻塞</span>
p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                                  <span class="token comment"># 关闭pool</span>
p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 结束工作进程</span>
p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>                                   <span class="token comment"># 主进程阻塞，等待子进程的退出</span></code></pre>

</details>

<details>
<summary>Pool方法(详)</summary>

<pre class="language-python" data-language="python"><code class="language-python">p<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwds<span class="token punctuation">)</span>                  <span class="token comment"># 阻塞</span>
p<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwds<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>  <span class="token comment"># 异步非阻塞</span>
p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                                  <span class="token comment"># 关闭pool，不再接受新的任务</span>
p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 结束工作进程，不再处理未完成的任务</span>
p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>                                   <span class="token comment"># 主进程阻塞，等待子进程的退出</span>

<span class="token number">1</span> 方法apply_async<span class="token punctuation">(</span><span class="token punctuation">)</span>和map_async<span class="token punctuation">(</span><span class="token punctuation">)</span>的返回值是AsyncResul的实例obj。实例具有以下方法
<span class="token number">2</span> obj<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>返回结果，如果有必要则等待结果到达。timeout是可选的。如果在指定时间内还没有到达，将引发一场。
如果远程操作中引发了异常，它将在调用此方法时再次被引发。
<span class="token number">3</span> obj<span class="token punctuation">.</span>ready<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>如果调用完成，返回<span class="token boolean">True</span>
<span class="token number">4</span> obj<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>如果调用完成且没有引发异常，返回<span class="token boolean">True</span>，如果在结果就绪之前调用此方法，引发异常
<span class="token number">5</span> obj<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">[</span>timeout<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>等待结果变为可用。
<span class="token number">6</span> obj<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>：立即终止所有工作进程，同时不执行任何清理或结束任何挂起工作。如果p被垃圾回收，将自动调用此函数</code></pre>

</details>

<p><a id="Pool examp"><font color="black"></font></a></p><h4><a id="Pool examp"><font color="black">Pool方法实例</font></a></h4><p></p>
<ul>
<li><a id="Pool0">使用多线程-应用apply</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"msg: "</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"func end"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    pool <span class="token operator">=</span> Pool<span class="token punctuation">(</span>processes<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        msg <span class="token operator">=</span> <span class="token string">"hello world{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token comment"># pool.apply(func=func, args=(msg, ))        # 阻塞！</span>
        pool<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token operator">=</span>func<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 非阻塞！</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"close......"</span><span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"done......"</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>注：<br>1.调用join之前，先调用close或者函数terminate，否则会出错<br>2.执行完close后不会有新的进程加入到pool,join函数等待所有子进程结</p>
</blockquote>
<ul>
<li><a id="Pool1">使用多线程-映射map</a></li>
</ul>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool

<span class="token keyword">def</span> <span class="token function">task</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'num:%d; PID:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num<span class="token operator">**</span><span class="token number">2</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># 阻塞</span>
    <span class="token comment"># p.map_async(task, range(20))  # 异步非阻塞</span></code></pre>

<blockquote>
<p><code>map()</code>和<code>map_async()</code>参数为迭代器类型</p>
</blockquote>
<hr>
<h2 id="分布式进程"><a href="#分布式进程" class="headerlink" title="分布式进程"></a>分布式进程</h2><p>分布式进程：将Process进程分布到多台机器上，充分利用多态机器的性能完成复杂的任务。通常会有一个服务进程作为调度者，将任务分布到其他多个进程中，依靠网络通信进行管理。</p>
<p>举个例子：使用多进程做爬虫程序时，一般会有两个进程。一个进程负责抓取链接地址，将链接地址放到queue中；另一个进程负责从queue中取链接地址进行下载和存储到本地。其中，queue需要暴露到进程通信的网络中。</p>
<p>创建分布式进程的<font color="red">大致步骤</font>（具体需求不同会有差异）：</p>
<ul>
<li><strong>STEP1</strong>：实例化Queue对象</li>
</ul>
<p>得有个队列Queue来存储任务/数据，用于不同进程的通信。<br><font color="orange">代码</font>：<code>queue = queue.Queue()</code></p>
<ul>
<li><strong>STEP2</strong>：注册Queue对象</li>
</ul>
<p>在实例化Queue对象后，还需要把Queue对象暴露在通信网络中才能使用。服务端需要注册对象及其方法，而客户端 只需要注册方法，不需要注册对象。<br><font color="orange">代码</font>：<br>服务端：<code>BaseManager.register("get_queue", callable=lambda: queue)</code><br>客户端：<code>BaseManager.register("get_queue")</code></p>
<ul>
<li><strong>STEP3</strong>：实例化Manager对象</li>
</ul>
<p>为了实现不同进程/主机间的通信，得绑定地址、端口和验证口令。<br><font color="orange">代码</font>：<code>manager = BaseManager(address=('127.0.0.1', 8001), authkey=b'pwword')</code></p>
<ul>
<li><strong>STEP3.5</strong>：冻结支持</li>
</ul>
<p>由于python在使用Manager时会出现一些 bug，需要在<code>mari()</code>里面使用冻结支持函数，之后才能正常进行开启服务、连接服务等操作。（上面有讲，忘记的话可以翻上去看一下）<br><font color="orange">代码</font>：<code>freeze_support()</code></p>
<ul>
<li><strong>STEP4</strong>：服务端开启，客户端连接</li>
</ul>
<p>服务器开启服务 或者 启动管理、监听信道；客户端连接服务端。<br><font color="orange">代码</font>：</p>
<ol>
<li>服务器启动管理：<code>manager.start()</code></li>
<li>服务器开启服务：<br>　　先获取服务器对象<code>server = manager.get_server()</code><br>　　　　　　　　然后永久开启服务：<code>server.serve_forever()</code></li>
<li>客户端连接服务端：<code>manager.connect()</code></li>
</ol>
<ul>
<li><strong>STEP5</strong>：从Manager对象获得Queue对象</li>
</ul>
<p>从Manager获取Queue，用于分配、执行任务<br><font color="orange">代码</font>：<code>queue = manager.get_queue()</code></p>
<ul>
<li><strong>STEP6</strong>：分配、执行任务</li>
</ul>
<p>一方(不一定是服务器)分配任务，另一方执行任务。<br><font color="orange">代码</font>：<br>分配：<code>queue.put(task)</code><br>执行：<code>queue.get()</code></p>
<ul>
<li><strong>STEP7</strong>：结束任务</li>
</ul>
<p>如果服务端使用永久开启服务(<strong>STEP4</strong>中的2.)，那么就不需要结束任务，否则就要结束任务进程。<br><font color="orange">代码</font>：<code>manager.shutdown()</code></p>
<details><summary>关于分布式进程中的队列Queue一些话</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
注意，当我们在一台机器上写多进程程序时，创建的Queue可以直接拿来用，
但是，在分布式多进程环境下，添加任务到Queue不可以直接对原始的task_queue进行操作，
那样就绕过了QueueManager的封装，必须通过manager.get_task_queue()获得的Queue接口添加。


任务进程要通过网络连接到服务进程，所以要指定服务进程的IP
先启动task_master.py服务进程
task_master.py进程发送完任务后，开始等待result队列的结果。
再启动task_worker.py进程
task_worker.py进程结束，在task_master.py进程中会继续打印出结果


Queue对象存储在哪？
注意到task_worker.py中根本没有创建Queue的代码，
所以，Queue对象存储在task_master.py进程中，即server
而Queue之所以能通过网络访问，就是通过QueueManager实现的。
由于QueueManager管理的不止一个Queue，
所以，要给每个Queue的网络调用接口起个名字，比如get_task_queue。
authkey有什么用？
这是为了保证两台机器正常通信，不被其他机器恶意干扰。
如果task_worker.py的authkey和task_master.py的authkey不一致，肯定连接不上。
"""</span></code></pre>

</details>

<h3 id="multiprocessing-managers-模块"><a href="#multiprocessing-managers-模块" class="headerlink" title="multiprocessing.managers 模块"></a><code>multiprocessing.managers</code> 模块</h3><ul>
<li>outline<ul>
<li><strong><a href="#managers intro">managers类介绍</a></strong></li>
<li><strong><a href="#managers examp">managers类实例</a></strong><ul>
<li><strong><a href="#managers1">managers示例1：使用BaseManager进行分布式进程任务（共三方参与）</a></strong></li>
<li><strong><a href="#managers2">managers示例2：使用BaseManager进行分布式进程任务（共两方参与）</a></strong></li>
<li><strong><a href="#managers3">managers示例3：使用BaseManager进行分布式进程任务（一对多）</a></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a id="managers intro"><font color="black"></font></a></p><h4><a id="managers intro"><font color="black">managers类介绍</font></a></h4><p></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 类</span>
<span class="token keyword">class</span> <span class="token class-name">BaseManager</span><span class="token punctuation">(</span>
    address<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         <span class="token comment"># 地址</span>
    authkey<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>         <span class="token comment"># 身份验证</span>
    serializer<span class="token operator">=</span><span class="token string">'pickle'</span><span class="token punctuation">,</span>  <span class="token comment"># 序列化程序</span>
    ctx<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>             <span class="token comment"># 断续器？</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre>

<details>
<summary>BaseManager 类方法(略)</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># todo 类方法</span>
BaseManager<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 为manager对象生成服务器进程</span>
BaseManager<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># 将manager对象连接到服务器进程</span>
BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 使用manager类型注册类型 ID</span>
BaseManager<span class="token punctuation">.</span>get_server<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 返回具有serve_forever()方法和地址属性的服务器对象</span>
BaseManager<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 加入manager进程（如果已生成）</span>
BaseManager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 关闭manager进程</span></code></pre>

</details>

<details><summary>BaseManager 类方法(详)</summary>
————————————
<details><summary>BaseManager.start()函数</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>initializer<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> initargs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    启动manager
    """</span></code></pre>

<p>具体使用见<font color="red">例2</font></p>
</details>
————————————
<details><summary>BaseManager.connect()函数</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    连接服务器进程
    """</span></code></pre>

<p>具体使用见<font color="red">例1</font></p>
</details>
————————————
<details><summary>BaseManager.register()函数</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span>
    typeid<span class="token punctuation">,</span>             <span class="token comment"># 字符串，类型标识符</span>
    <span class="token builtin">callable</span><span class="token punctuation">,</span>           <span class="token comment"># 可调用对象的</span>
    proxytype<span class="token punctuation">,</span>          <span class="token comment"># </span>
    exposed<span class="token punctuation">,</span>            <span class="token comment"># </span>
    method_to_typeid<span class="token punctuation">,</span>   <span class="token comment"># </span>
    create_method<span class="token punctuation">,</span>      <span class="token comment"># </span>
<span class="token punctuation">)</span><span class="token punctuation">:</span></code></pre>

<blockquote>
<p>说得通俗一点：<br>1.<code>register</code>函数干的事就是给<code>BaseManager</code>类注册一个函数（类似动态绑定？）<br>2.<code>typeid</code>参数就是注册对象可以调用的函数<br>3.<code>callable</code>参数一般是队列的实例化对象，一般用函数返回，如下所示：</p>
</blockquote>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> queue
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> BaseManager
q <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># todo 法1：定义函数</span>
<span class="token keyword">def</span> <span class="token function">get_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> q
    <span class="token keyword">return</span> q
BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_q'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>get_q<span class="token punctuation">)</span>

<span class="token comment"># todo 法2：匿名函数</span>
BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_q'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> q<span class="token punctuation">)</span>

<span class="token comment"># 建议使用标准函数来代替lambda函数，避免python2.7中，pickle无法序列化lambda的问题，虽然但是现在基本都在用python3</span></code></pre>

  <details><summary>BaseManager.register() 的(官方？)参数描述(已翻译)：</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>
    typeid<span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        typeid is a “type identifier” which is used to identify a particular type of shared object. This must be a string.
        typeid 是一个“类型标识符”，用于标识特定类型的共享对象。这必须是一个字符串。
        """</span>
    <span class="token builtin">callable</span><span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        callable is a callable used for creating objects for this type identifier. 
        callable 是一个可调用的使用，用于为此类型标识符创建对象。

        If a manager instance will be created using the from_address() classmethod or if the create_method argument is False then this can be left as None.
        如果将使用from_address()类方法或 create_method=False 创建 Manager 实例，则这可以留下。
        """</span>
    proxytype<span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        proxytype is a subclass of BaseProxy which is used to create proxies for shared objects with this typeid. 
        proxytype 是BaseProxy的子类，用于创建具有此类型的共享对象的代理。

        If None then a proxy class is created automatically.
        如果 proxytype=None，则自动创建代理类proxy。
        """</span>
    exposed<span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        exposed is used to specify a sequence of method names which proxies for this typeid should be allowed to access using BaseProxy._callmethod(). 
        exposed 用于指定应允许使用 BaseProxy._callMethod() 的代理的方法名称的序列。

        (If exposed is None then proxytype._exposed_ is used instead if it exists.) 
        （如果 exposed=None，则不使用proxytype._exposed_如果存在。）

        In the case where no exposed list is specified, all “public methods” of the shared object will be accessible. 
        在未指定未公开列表的情况下，将可以访问共享对象的所有“公共方法”。

        (Here a “public method” means any attribute which has a __call__() method and whose name does not begin with '_'.)
        （这里有一个“公共方法”是指具有 __call __()方法的任何属性，其名称不会以'_'开头。）
        """</span>
    method_to_typeid<span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        method_to_typeid is a mapping used to specify the return type of those exposed methods which should return a proxy. It maps method names to typeid strings. 
        method_to_typeId 是用于指定应返回代理的那些公开方法的返回类型的映射。它将方法名称映射到 typeid 字符串。

        (If method_to_typeid is None then proxytype._method_to_typeid_ is used instead if it exists.) 
        （如果method_to_typeId=None，则使用proxytype._method_to_typeid_，而不是存在。）

        If a method’s name is not a key of this mapping or if the mapping is None then the object returned by the method will be copied by value.
        如果方法的名称不是此映射的键，或者如果映射为None，则该方法返回的对象将被值复制。
        """</span>
    create_method<span class="token punctuation">,</span> 
        <span class="token triple-quoted-string string">"""
        create_method determines whether a method should be created with name typeid which can be used to tell the server process to create a new shared object and return a proxy for it. By default it is True.
        create_method 确定是否应该使用名称类型创建方法，该类型可以用于告诉服务器进程创建新的共享对象并返回代理。默认create_method=True。
        """</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A classmethod which can be used for registering a type or callable with the manager class.
    一个类方法，可用于注册类型或可调用manager类。
    """</span></code></pre>

  </details>
</details>
————————————
<details><summary>BaseManager.get_server() 函数</summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    返回有serve_forever()方法的服务器对象
    """</span></code></pre>

<p>具体使用见<font color="red">例1</font></p>
</details>
————————————
<details><summary>BaseManager.join() 函数</summary>

<p>这个函数没啥好说的，可以参考之前的<code>join</code>，但是貌似在这很少用到。。。。。。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">join</span><span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></code></pre>

</details>
————————————
<details><summary><font>BaseManager.shutdown() 函数</font></summary>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> BaseManager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">"""
    只有当进程start()之后才能使用，用于关闭manager进程
    """</span></code></pre>

<p>具体使用见<font color="red">例2</font></p>
</details>
————————————
</details>



<p><a id="managers examp"><font color="black"></font></a></p><h4><a id="managers examp"><font color="black">managers类实例</font></a></h4><p></p>
<p>————————————————————————————————————————</p>
<ul>
<li><a id="managers1">managers示例1：使用BaseManager进行分布式进程任务（共三方参与）</a></li>
</ul>
<p>实例说明：本例中继承了<code>BaseManager</code>类，当然，把其中的<code>QueueManager</code>换成<code>BaseManager</code>也是完全没问题的。</p>
<p><font color="red">服务端Server</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> queue
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager

que <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"get_queue"</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span>que<span class="token punctuation">)</span>
m <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

s <span class="token operator">=</span> m<span class="token punctuation">.</span>get_server<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><font color="red">发送端Send</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager


<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"get_queue"</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

queue <span class="token operator">=</span> m<span class="token punctuation">.</span>get_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span></code></pre>

<p><font color="red">接收端Recv</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager


<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"get_queue"</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

queue <span class="token operator">=</span> m<span class="token punctuation">.</span>get_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>address<span class="token punctuation">)</span></code></pre>

<blockquote>
<p>使用方法：依次启动服务端、发送端和接收端即可。</p>
</blockquote>
<p>————————————————————————————————————————</p>
<ul>
<li><a id="managers2">managers示例2：使用BaseManager进行分布式进程任务（共两方参与）</a></li>
</ul>
<p>实例说明：manager服务端用于控制，worker工作及用于执行。这个例子创建了两个队列，大体思路差不多，具体步骤可展开下面内容查看。</p>
<details><summary>创建分布式进程需要的<font color="red">步骤</font>：</summary>

<ul>
<li><strong>一、建立用于进程间通信的队列Queue</strong></li>
</ul>
<p>服务进程创建任务队列 task_queue 和结果队列 result_queue。任务队列 task_queue 用来作为<font color="orange">传递任务给任务进</font>程的通道；服务进程创建结果队列 result_queue 用来作为任务进程<font color="orange">完成任务后回复服务进程</font>的通道。在分布式多进程环境下，必须由 Queuemanager 获得 Queue 接口来添加任务。</p>
<ul>
<li><strong>二、在网络上注册第一步中建立的队列，暴露给其他进程（主机）</strong></li>
</ul>
<p>注册后获得网络队列，相当于本地队列的映像。</p>
<ul>
<li><strong>三、建立对象实例manager，绑定端口和验证口令</strong></li>
</ul>
<p>对象的类Queuemanager继承自BaseManager</p>
<ul>
<li><strong>四、启动管理实例manager，监管信息通道</strong></li>
</ul>
<p>即：启动第三步中建立的实例</p>
<ul>
<li><strong>五、通过管理实例的方法获得通过网络访问的Queue对象</strong></li>
</ul>
<p>即：再把网络队列实体化成可以使用的本地队列</p>
<ul>
<li><strong>六、创建任务、上传任务、分配任务</strong></li>
</ul>
<p>创建任务到 “本地”队列中，自动上传任务到网络队列中，分配给任务进程进行处理。</p>
</details>

<p><font color="red">manager服务器</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> freeze_support<span class="token punctuation">,</span> Queue

<span class="token comment"># 任务个数</span>
task_number <span class="token operator">=</span> <span class="token number">10</span>

<span class="token comment"># 收发队列</span>
task_quue <span class="token operator">=</span> Queue<span class="token punctuation">(</span>task_number<span class="token punctuation">)</span>
result_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span>task_number<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> task_quue


<span class="token keyword">def</span> <span class="token function">get_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> result_queue


<span class="token comment"># 创建类似的queueManager</span>
<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">win_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 注册在网络上，callable 关联了Queue 对象</span>
    <span class="token comment"># 将Queue对象在网络中暴露</span>
    <span class="token comment">#window下绑定调用接口不能直接使用lambda，所以只能先定义函数再绑定</span>
    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>get_task<span class="token punctuation">)</span>
    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>get_result<span class="token punctuation">)</span>
    <span class="token comment"># 绑定端口和设置验证口令</span>
    manager <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">8001</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">'qiye'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 启动管理，监听信息通道</span>
    manager<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>

        <span class="token comment"># 通过网络获取任务队列和结果队列</span>
        task <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 添加任务</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"ImageUrl_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'url is %s'</span> <span class="token operator">%</span> url<span class="token punctuation">)</span>
            task<span class="token punctuation">.</span>put<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'try get result'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result is %s'</span> <span class="token operator">%</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Manager error'</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        manager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># window下多进程可能有问题，添加这句话缓解</span>
    freeze_support<span class="token punctuation">(</span><span class="token punctuation">)</span>
    win_run<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><font color="red">worker工作机</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager

<span class="token comment"># 创建类似的QueueManager:</span>
<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 实现第一步：使用QueueManager注册获取Queue的方法名称</span>
QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">)</span>
QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">)</span>

<span class="token comment"># 实现第二步：连接到服务器:</span>
server_addr <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connect to server %s...'</span> <span class="token operator">%</span> server_addr<span class="token punctuation">)</span>
<span class="token comment"># 端口和验证口令注意保持与服务进程设置的完全一致:</span>
m <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">,</span> <span class="token number">8001</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">'qiye'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 从网络连接:</span>
m<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 实现第三步：获取Queue的对象:</span>
task <span class="token operator">=</span> m<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> m<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 实现第四步：从task队列取任务,并把结果写入result队列:</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">not</span> task<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        image_url <span class="token operator">=</span> task<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'run task download %s...'</span> <span class="token operator">%</span> image_url<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        result<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'%s---&gt;success'</span><span class="token operator">%</span>image_url<span class="token punctuation">)</span>
<span class="token comment"># 处理结束:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'worker exit.'</span><span class="token punctuation">)</span></code></pre>

<p>————————————————————————————————————————</p>
<ul>
<li><a id="managers3">managers示例3：使用BaseManager进行分布式进程任务（一对多）</a></li>
</ul>
<p>实例说明：与例2差不多，依次启动服务端和多个客户端即可。</p>
<p><font color="red">服务端manager</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:utf-8</span>

<span class="token keyword">import</span> random<span class="token punctuation">,</span> time<span class="token punctuation">,</span> queue
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager

<span class="token comment"># 发送任务的队列</span>
task_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 接收结果的队列</span>
result_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 使用标准函数来代替lambda函数，避免python2.7中，pickle无法序列化lambda的问题</span>
<span class="token keyword">def</span> <span class="token function">get_task_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> task_queue
    <span class="token keyword">return</span> task_queue


<span class="token comment"># 使用标准函数来代替lambda函数，避免python2.7中，pickle无法序列化lambda的问题</span>
<span class="token keyword">def</span> <span class="token function">get_result_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> task_queue
    <span class="token keyword">return</span> task_queue


<span class="token keyword">def</span> <span class="token function">startManager</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> authkey<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 把两个Queue都注册到网络上，callable参数关联了Queue对象，注意回调函数不能使用括号</span>
    BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>get_task_queue<span class="token punctuation">)</span>
    BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>get_result_queue<span class="token punctuation">)</span>
    <span class="token comment"># 设置host,绑定端口port，设置验证码为authkey</span>
    manager <span class="token operator">=</span> BaseManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span>authkey<span class="token punctuation">)</span>
    <span class="token comment"># 启动manager服务器</span>
    manager<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> manager


<span class="token keyword">def</span> <span class="token function">put_queue</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 通过网络访问queueu</span>
    task <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Put task %d'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>
        task<span class="token punctuation">.</span>put<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    host <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
    port <span class="token operator">=</span> <span class="token number">5000</span>
    authkey <span class="token operator">=</span> <span class="token string">'abc'</span>
    <span class="token comment"># 启动manager服务器</span>
    manager <span class="token operator">=</span> startManager<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> authkey<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 给task队列添加数据</span>
    put_queue<span class="token punctuation">(</span>manager<span class="token punctuation">)</span>
    <span class="token comment"># 关闭服务器</span>
    manager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><font color="red">执行端worker</font></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># encoding:utf-8</span>

<span class="token keyword">import</span> random<span class="token punctuation">,</span> time<span class="token punctuation">,</span> queue
<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager


<span class="token keyword">def</span> <span class="token function">start_worker</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> authkey<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 由于这个BaseManager只从网络上获取queue，所以注册时只提供名字</span>
    BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">)</span>
    BaseManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Connect to server %s'</span> <span class="token operator">%</span> host<span class="token punctuation">)</span>
    <span class="token comment"># 注意，端口port和验证码authkey必须和manager服务器设置的完全一致</span>
    worker <span class="token operator">=</span> BaseManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span>authkey<span class="token punctuation">)</span>
    <span class="token comment"># 链接到manager服务器</span>
    worker<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> worker


<span class="token keyword">def</span> <span class="token function">get_queue</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">:</span>
    task <span class="token operator">=</span> worker<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> worker<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 从task队列取数据，并添加到result队列中</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> task<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        n <span class="token operator">=</span> task<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'worker get %d'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>
        result<span class="token punctuation">.</span>put<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    host <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
    port <span class="token operator">=</span> <span class="token number">5000</span>
    authkey <span class="token operator">=</span> <span class="token string">'abc'</span>
    <span class="token comment"># 启动worker</span>
    worker <span class="token operator">=</span> start_worker<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> authkey<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取队列</span>
    get_queue<span class="token punctuation">(</span>worker<span class="token punctuation">)</span></code></pre>

<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>较全的进程内容：</p>
<table>
<thead>
<tr>
<th align="center">连接</th>
<th align="center">标签</th>
<th align="center">说明</th>
<th align="center">网站</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41922768/category_7767239.html">python基础-进程</a></td>
<td align="center"><code>multiprocessing</code></td>
<td align="center">这个专栏系列内容很多很全、讲原理、解释参数、实例多</td>
<td align="center">CSDN</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017628290184064">多进程</a></td>
<td align="center"><code>Process</code> <code>Queue</code> <code>Pool</code></td>
<td align="center">讲原理、不解释参数、一般</td>
<td align="center">廖雪峰的官方网站</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dbf-/p/11127000.html">Python process (进程)</a></td>
<td align="center"><code>Process</code> <code>Pipe</code> <code>Queue</code> <code>Manager</code> <code>Lock</code> <code>Pool</code></td>
<td align="center">不解释参数、有一定原理内容</td>
<td align="center">博客园</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yzh2857/p/9683398.html">《Python》进程之间的通信（IPC）、进程之间的数据共享、进程池</a></td>
<td align="center"><code>Pipe</code> <code>Queue</code> <code>JoinableQueue</code> <code>Manager</code> <code>Process</code> <code>Lock</code> <code>Pool</code></td>
<td align="center">解释参数、有一定的原理、有上述未涉及内容</td>
<td align="center">博客园</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/64702600">一篇文章搞定Python多进程(全)</a></td>
<td align="center"><code>Process</code> <code>Pipe</code> <code>Queue</code> <code>Manager</code> <code>Pool</code></td>
<td align="center">解释参数、有一定的原理、有上述未涉及内容</td>
<td align="center">知乎</td>
</tr>
</tbody></table>
<p>线程池：</p>
<table>
<thead>
<tr>
<th align="center">连接</th>
<th align="center">标签</th>
<th align="center">说明</th>
<th align="center">网站</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a target="_blank" rel="noopener" href="https://hexo.yuanjh.cn/hexo/e279ffad/">python进阶08并发之四map, apply, map_async, apply_async差异</a></td>
<td align="center"><code>Pool</code></td>
<td align="center">并发map/apply的差异</td>
<td align="center">个人博客</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="http://blog.shenwei.me/python-multiprocessing-pool-difference-between-map-apply-map_async-apply_async/">Python multiprocessing.Pool: Difference between map, apply, map_async, apply_async</a></td>
<td align="center"><code>Pool</code></td>
<td align="center">并发map/apply的差异</td>
<td align="center">个人博客？</td>
</tr>
</tbody></table>
<p><code>subprocess</code>：</p>
<table>
<thead>
<tr>
<th align="center">连接</th>
<th align="center">标签</th>
<th align="center">说明</th>
<th align="center">网站</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39059031/article/details/108440342">Python进阶(十)多进程multiprocessing和subprocess模块</a></td>
<td align="center"><code>multiprocessing</code> <code>subprocess</code></td>
<td align="center">原理讲明白、参数解释清楚、例子多（插一句，里面的python系列内容也写的挺好的）</td>
<td align="center">CSDN</td>
</tr>
</tbody></table>
<p>分布式进程：（大概看一下就行了，毕竟大家都是互相抄的）</p>
<table>
<thead>
<tr>
<th align="center">连接</th>
<th align="center">标签</th>
<th align="center">说明</th>
<th align="center">网站</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.8/library/multiprocessing.html?highlight=freeze_support#examples">multiprocessing — 基于进程的并行</a></td>
<td align="center"><code>multiprocessing</code></td>
<td align="center">python官网的例子</td>
<td align="center">python官网</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liunnis/tag/BaseManager/">BaseManager</a></td>
<td align="center"><code>BaseManager</code></td>
<td align="center">这个系列有.东西</td>
<td align="center">博客园</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/guguobao/p/9400299.html">python分布式进程</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">博客园</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chmyee/p/10081531.html">python 分布式进程实现</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">博客园</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://www.ktanx.com/blog/p/870">python 分布式进程</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">ktanx</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://blog.csdn.net/chengxun03/article/details/105802073">在Python程序中实现分布式进程的教程</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">CSDN</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="https://blog.csdn.net/lilong117194/article/details/76051843">python分布式进程（windows下）</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">CSDN</td>
</tr>
<tr>
<td align="center"><a target="_blank" rel="noopener" href="http://t.zoukankan.com/bin-l-p-8615201.html">Python 分布式进程</a></td>
<td align="center"><code>managers</code></td>
<td align="center">。。。。。。</td>
<td align="center">个人博客</td>
</tr>
</tbody></table>
<h2 id="待完成"><a href="#待完成" class="headerlink" title="待完成"></a>待完成</h2><ul>
<li><input disabled="" type="checkbox"> socket实例</li>
<li><input checked="" disabled="" type="checkbox"> 通信模式</li>
<li><input disabled="" type="checkbox"> <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41922768/article/details/83995322">进程同步</a></li>
<li><input checked="" disabled="" type="checkbox"> <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41922768/article/details/84024587">数据共享Manager</a></li>
<li><input checked="" disabled="" type="checkbox"> <a target="_blank" rel="noopener" href="https://blog.csdn.net/ctwy291314/article/details/89358144">共享内存Value,Array</a></li>
<li><input disabled="" type="checkbox"> 子进程<code>subprocess</code></li>
<li><input checked="" disabled="" type="checkbox"> 进程池</li>
<li><input disabled="" type="checkbox"> IO序列化</li>
<li><input checked="" disabled="" type="checkbox"> 分布式进程</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hhhhmdzz</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hhhhmdzz.github.io/2022/03/09/python-jin-cheng/">https://hhhhmdzz.github.io/2022/03/09/python-jin-cheng/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hhhhmdzz</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/python/">
                                    <span class="chip bg-color">python</span>
                                </a>
                            
                                <a href="/tags/%E8%BF%9B%E7%A8%8B/">
                                    <span class="chip bg-color">进程</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    // new Valine({
    //     el: '#vcomments',
    //     appId: 'Ei1XiJqo7bzRu5lBjbBUXPIu-gzGzoHsz',
    //     appKey: 'Ojx0e72LHhv1hUfFNQO9tInO',
    //     serverURLs: '',
    //     notify: 'false' === 'true',
    //     verify: 'false' === 'true',
    //     visitor: 'true' === 'true',
    //     avatar: 'mm',
    //     pageSize: '10',
    //     lang: 'zh-cn',
    //     placeholder: 'just go go'
    // });
    new Valine({
        el: '#vcomments',
        appId: 'Ei1XiJqo7bzRu5lBjbBUXPIu-gzGzoHsz',
        appKey: 'Ojx0e72LHhv1hUfFNQO9tInO',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go',
        enableQQ: true,
        emojiCDN: '//i0.hdslb.com/bfs/emote/', 
        // 表情title和图片映射
        emojiMaps: {
        "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
        "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
        "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
        "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
        "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
        "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
        "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
        "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
        "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
        "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
        "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
        "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png",
        "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
        "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
        "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
        "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
        "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
        "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
        "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
        "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
        "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
        "tv_打脸": "56ab10b624063e966bfcb76ea5dc4794d87dfd47.png",
        "tv_抓狂": "fe31c08edad661d63762b04e17b8d5ae3c71a757.png",
        "tv_抠鼻": "c666f55e88d471e51bbd9fab9bb308110824a6eb.png",
        "tv_斜眼笑": "911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png",
        "tv_无奈": "ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png",
        "tv_晕": "5443c22b4d07fb1907ccc610c8e6db254f2461b7.png",
        "tv_流汗": "cead1c351ab8d79e9f369605beb90148db0fbed3.png",
        "tv_流泪": "7e71cde7858f0cd50d74b0264aa26db612a8a167.png",
        "tv_流鼻血": "c32d39db2737f89b904ca32700d140a9241b0767.png",
        "tv_点赞": "f85c354995bd99e28fc76c869bfe42ba6438eff4.png",
        "tv_生气": "26702dcafdab5e8225b43ffd23c94ac1ff932654.png",
        "tv_生病": "8b0ec90e6b86771092a498c54f09fc94621c1900.png",
        "tv_疑问": "0793d949b18d7be716078349c202c15ff166f314.png",
        "tv_白眼": "c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",
        "tv_皱眉": "72ccad6679fea0d14cce648b4d818e09b8ffea2d.png",
        "tv_目瞪口呆": "0b8cb81a68de5d5365212c99375e7ace3e7891b7.png",
        "tv_睡着": "8b196675b53af58264f383c50ad0945048290b33.png",
        "tv_笑哭": "1abc628f6d4f4caf9d0e7800878f4697abbc8273.png",
        "tv_腼腆": "89712c0d4af73e67f89e35cbc518420380a7f6f4.png",
        "tv_色": "61822c7e9aae5da76475e7892534545336b23a6f.png",
        "tv_调侃": "4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png",
        "tv_调皮": "b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png",
        "tv_鄙视": "6e72339f346a692a495b123174b49e4e8e781303.png",
        "tv_闭嘴": "c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png",
        "tv_难过": "87f46748d3f142ebc6586ff58860d0e2fc8263ba.png",
        "tv_馋": "fc7e829b845c43c623c8b490ee3602b7f0e76a31.png",
        "tv_鬼脸": "0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png",
        "tv_黑人问号": "45821a01f51bc867da9edbaa2e070410819a95b2.png",
        "tv_鼓掌": "1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"
        },
        requiredFields: ['nick','mail'], //设置必填项
    });
</script>

<!--酷Q推送-->


<!-- 自己添加的内容 -->

<!-- 直达评论 -->
<div id="to_comment" class="comment-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#vcomments" title="直达评论">
        <i class="fas fa-comments"></i>
    </a>
</div>


    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/03/09/python-xian-cheng/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="python线程">
                        
                        <span class="card-title">python线程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            python线程相关模块的使用
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-03-09
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/python/" class="post-category">
                                    python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/%E7%BA%BF%E7%A8%8B/">
                        <span class="chip bg-color">线程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                本篇&nbsp;<i class="far fa-dot-circle"></i>
            </div>
            <div class="card">
                <a href="/2022/03/09/python-jin-cheng/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="python进程">
                        
                        <span class="card-title">python进程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            python进程相关模块的使用
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-03-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/python/" class="post-category">
                                    python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/%E8%BF%9B%E7%A8%8B/">
                        <span class="chip bg-color">进程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="8531859362"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <a href="/about" target="_blank">hhhhmdzz</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">87.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2021";
                        var startMonth = "6";
                        var startDate = "28";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);
                        
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
                        
                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                // yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天' + diffHours + '小时' + diffMinutes + '分钟' + diffSeconds + '秒';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    // calcSiteTime();
                    setInterval("calcSiteTime()", 250);
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hhhhmdzz" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1453584196@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1453584196" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1453584196" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    
        <!-- <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script> -->
        <script src='/libs/mermaid/mermaid.min.js'></script>
        <script>
          if (window.mermaid) {
            mermaid.initialize({theme: 'forest'});
          }
        </script>
    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
